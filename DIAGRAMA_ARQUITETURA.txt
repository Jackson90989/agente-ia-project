```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    NOVA ARQUITETURA - AgenteIA v2.0                           â•‘
â•‘                     OrganizaÃ§Ã£o Modular em Camadas                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€ REQUISIÃ‡ÃƒO HTTP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                               â”‚
â”‚  GET /api/alunos/1                                                          â”‚
â”‚  POST /api/requerimentos                                                    â”‚
â”‚  PUT /api/pagamentos/:id                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚    ğŸŒ CAMADA DE ROTAS (routes/)     â”‚
             â”‚                                      â”‚
             â”‚  â€¢ alunos.py (159 linhas)           â”‚
             â”‚  â€¢ auth.py (170 linhas)             â”‚
             â”‚  â€¢ cursos.py (23 linhas)            â”‚
             â”‚  â€¢ requerimentos.py (294 linhas)    â”‚  â† Ainda em routes/
             â”‚                                      â”‚    (compatibilidade)
             â”‚  Responsabilidades:                 â”‚
             â”‚  âœ“ Receber requisiÃ§Ãµes HTTP         â”‚
             â”‚  âœ“ Validar entrada                  â”‚
             â”‚  âœ“ Chamar services                  â”‚
             â”‚  âœ“ Formatar resposta                â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚   ğŸ’¼ CAMADA DE SERVIÃ‡OS (services/)  â”‚
             â”‚                                      â”‚
             â”‚  â€¢ aluno_service.py (novo)          â”‚
             â”‚  â€¢ auth_service.py (novo)           â”‚
             â”‚  â€¢ curso_service.py (novo)          â”‚
             â”‚  â€¢ matricula_service.py (novo)      â”‚
             â”‚  â€¢ pagamento_service.py (67 linhas) â”‚
             â”‚  â€¢ requerimento_service.py (213)    â”‚
             â”‚  â€¢ mcp_integration.py (115 linhas)  â”‚
             â”‚                                      â”‚
             â”‚  Responsabilidades:                 â”‚
             â”‚  âœ“ Validar dados de negÃ³cio        â”‚
             â”‚  âœ“ Aplicar regras                   â”‚
             â”‚  âœ“ TransaÃ§Ãµes BD                    â”‚
             â”‚  âœ“ LÃ³gica complexa                  â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚    ğŸ“¦ CAMADA DE MODELOS (models/)    â”‚
             â”‚                                      â”‚
             â”‚  â€¢ aluno.py (75 linhas)             â”‚
             â”‚  â€¢ usuario.py (65 linhas)           â”‚
             â”‚  â€¢ curso.py (35 linhas)             â”‚
             â”‚  â€¢ materia.py (40 linhas)           â”‚
             â”‚  â€¢ matricula.py (60 linhas)         â”‚
             â”‚  â€¢ requerimento.py (75 linhas)      â”‚
             â”‚  â€¢ pagamento.py (45 linhas)         â”‚
             â”‚                                      â”‚
             â”‚  Responsabilidades:                 â”‚
             â”‚  âœ“ Definir estrutura das dados     â”‚
             â”‚  âœ“ Relacionamentos                  â”‚
             â”‚  âœ“ SerializaÃ§Ã£o (to_dict)          â”‚
             â”‚  âœ“ ValidaÃ§Ãµes de campo             â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  ğŸ—„ï¸  BANCO DE DADOS  â”‚
                    â”‚  (SQLite3)          â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ SUPORTE (usado por todas as camadas) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                               â”‚
â”‚  ğŸ” CORE (src/core/)           ğŸ› ï¸ UTILS (src/utils/)                        â”‚
â”‚  â”œâ”€â”€ errors.py                 â”œâ”€â”€ constants.py                             â”‚
â”‚  â”‚   â€¢ ValidationError          â”‚   â€¢ ALUNO_STATUS_ATIVO                    â”‚
â”‚  â”‚   â€¢ AuthenticationError       â”‚   â€¢ REQUERIMENTO_STATUS_*                â”‚
â”‚  â”‚   â€¢ NotFoundError             â”‚   â€¢ PAGAMENTO_STATUSES                   â”‚
â”‚  â”‚   â€¢ ConflictError             â”‚   â€¢ MAX_SENHA_LENGTH                     â”‚
â”‚  â”‚   â€¢ DatabaseError             â”‚                                         â”‚
â”‚  â”‚   â€¢ MCPError                  â”œâ”€â”€ validators.py                          â”‚
â”‚  â”‚   â€¢ PDFGenerationError        â”‚   â€¢ validar_cpf()                        â”‚
â”‚  â”‚                               â”‚   â€¢ validar_email()                      â”‚
â”‚  â”œâ”€â”€ logger.py                  â”‚   â€¢ validar_telefone()                   â”‚
â”‚  â”‚   â€¢ setup_logger()            â”‚   â€¢ validar_senha()                      â”‚
â”‚  â”‚   â€¢ get_logger()              â”‚                                         â”‚
â”‚  â”‚                               â”œâ”€â”€ formatters.py                          â”‚
â”‚  â”œâ”€â”€ security.py                â”‚   â€¢ formatar_cpf()                       â”‚
â”‚  â”‚   â€¢ generate_secure_token()   â”‚   â€¢ formatar_telefone()                 â”‚
â”‚  â”‚   â€¢ hash_password()           â”‚   â€¢ formatar_data()                     â”‚
â”‚  â”‚   â€¢ verify_password()         â”‚   â€¢ formatar_moeda()                    â”‚
â”‚  â”‚   â€¢ generate_code()           â”‚                                         â”‚
â”‚  â”‚   â€¢ generate_numeric_code()   â”œâ”€â”€ helpers.py                             â”‚
â”‚  â”‚                               â”‚   â€¢ criar_resposta_json()                â”‚
â”‚  â”œâ”€â”€ pdf_generator.py           â”‚   â€¢ paginar_lista()                      â”‚
â”‚  â”‚   â€¢ gerar_declaracao_pdf()    â”‚   â€¢ gerar_matricula()                    â”‚
â”‚  â”‚                               â”‚   â€¢ calcular_idade()                     â”‚
â”‚  â”‚                               â”‚                                         â”‚
â”‚  â”‚                               â”œâ”€â”€ decorators.py                          â”‚
â”‚  â”‚                               â”‚   â€¢ @requer_autenticacao                 â”‚
â”‚  â”‚                               â”‚   â€¢ @requer_admin                        â”‚
â”‚  â”‚                               â”‚   â€¢ @requer_funcionario                  â”‚
â”‚  â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                           ğŸ“Š ANTES vs DEPOIS                                   â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                                â•‘
â•‘  ANTES:                          â”‚  DEPOIS:                                   â•‘
â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€             â•‘
â•‘  âŒ app.py (59 linhas)            â”‚  âœ… app.py (59 linhas)                    â•‘
â•‘  âŒ models.py (320 linhas!)       â”‚  âœ… src/models/ (8 arquivos, 475 linhas)  â•‘
â•‘  âŒ ValidaÃ§Ã£o em routes/          â”‚  âœ… src/utils/validators.py              â•‘
â•‘  âŒ Exception genÃ©rica            â”‚  âœ… src/core/errors.py (10 tipos)        â•‘
â•‘  âŒ logging.getLogger() manual     â”‚  âœ… src/core/get_logger()                â•‘
â•‘  âŒ Constantes espalhadas         â”‚  âœ… src/utils/constants.py               â•‘
â•‘  âŒ FormataÃ§Ã£o em routes/         â”‚  âœ… src/utils/formatters.py              â•‘
â•‘  âŒ agente_ia: 2158 linhas        â”‚  âœ… Pronto para dividir                   â•‘
â•‘  âŒ mcp: 1535 linhas              â”‚  âœ… em 3 arquivos ~600 linhas            â•‘
â•‘                                  â”‚                                           â•‘
â•‘  ğŸ“ˆ Complexidade CiclomÃ¡tica      â”‚  ğŸ“‰ Muito melhorada                       â•‘
â•‘  ğŸ”´ DifÃ­cil encontrar cÃ³digo      â”‚  ğŸŸ¢ LocalizaÃ§Ã£o imediata                  â•‘
â•‘  ğŸ”´ Hard-coded em vÃ¡rios lugares  â”‚  ğŸŸ¢ Centralizado (constants)             â•‘
â•‘  ğŸ”´ Teste = IntegraÃ§Ã£o            â”‚  ğŸŸ¢ Unit test + Integration               â•‘
â•‘  ğŸ”´ Equipe = Conflitos            â”‚  ğŸŸ¢ Trabalho paralelo                     â•‘
â•‘                                                                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                        ğŸ’» EXEMPLO DE FLUXO PRÃTICO                             â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                                â•‘
â•‘  1ï¸âƒ£  UsuÃ¡rio faz requisiÃ§Ã£o:                                                   â•‘
â•‘     POST /api/requerimentos/declaracao                                         â•‘
â•‘     {                                                                          â•‘
â•‘       "aluno_id": 1,                                                           â•‘
â•‘       "tipo": "frequencia"                                                     â•‘
â•‘     }                                                                          â•‘
â•‘                                                                                â•‘
â•‘  2ï¸âƒ£  routes/requerimentos.py recebe:                                           â•‘
â•‘     @requerimentos_bp.route('/declaracao', methods=['POST'])                    â•‘
â•‘     def criar_declaracao():                                                    â•‘
â•‘         data = request.get_json()                                              â•‘
â•‘         validar_campos_obrigatorios(data, ['aluno_id', 'tipo'])  â† utils/     â•‘
â•‘         requerimento = RequerimentoService.criar(data)  â† chama service       â•‘
â•‘         return jsonify(requerimento.to_dict()), 201                            â•‘
â•‘                                                                                â•‘
â•‘  3ï¸âƒ£  services/requerimento_service.py executa lÃ³gica:                          â•‘
â•‘     def criar(dados):                                                          â•‘
â•‘         if not Aluno.query.get(dados['aluno_id']):                             â•‘
â•‘             raise NotFoundError("Aluno nÃ£o encontrado")  â† core/errors        â•‘
â•‘         req = Requerimento(...)  â† models/requerimento.py                     â•‘
â•‘         gerar_pdf = gerar_declaracao_pdf(...)  â† core/pdf_generator          â•‘
â•‘         db.session.add(req)                                                    â•‘
â•‘         db.session.commit()  â† transaÃ§Ã£o                                       â•‘
â•‘         logger.info(f"Requerimento criado: {req.id}")  â† core/logger          â•‘
â•‘         return req                                                             â•‘
â•‘                                                                                â•‘
â•‘  4ï¸âƒ£  models/requerimento.py serializa:                                         â•‘
â•‘     def to_dict(self):                                                         â•‘
â•‘         return {                                                               â•‘
â•‘             'id': self.id,                                                     â•‘
â•‘             'aluno_nome': self.aluno.nome_completo,  â† relacionamento         â•‘
â•‘             'declaracao_info': { ... }  â† estrutura definida                  â•‘
â•‘         }                                                                       â•‘
â•‘                                                                                â•‘
â•‘  5ï¸âƒ£  Resposta enviada ao cliente:                                              â•‘
â•‘     200 OK                                                                     â•‘
â•‘     {                                                                          â•‘
â•‘       "id": 19,                                                                â•‘
â•‘       "aluno_nome": "JoÃ£o Silva",                                              â•‘
â•‘       "declaracao_info": {                                                      â•‘
â•‘         "tipo": "frequencia",                                                   â•‘
â•‘         "pdf_path": "declaracoes/..."                                          â•‘
â•‘       }                                                                        â•‘
â•‘     }                                                                          â•‘
â•‘                                                                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ¨ RESULTADO: CÃ³digo claro, testÃ¡vel, manutenÃ­vel e escalÃ¡vel!
```
